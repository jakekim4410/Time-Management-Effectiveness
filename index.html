<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œê°„ê´€ë¦¬ íš¨ê³¼ì„± ì§„ë‹¨</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2canvas CDN for capturing HTML to image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Google Fonts - Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f3f4f6; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align items to the top for better scroll behavior */
            min-height: 100vh;
            padding: 2rem 0; /* Add padding top/bottom */
        }
        .container {
            background-color: #ffffff;
            border-radius: 1.5rem; /* Rounded corners */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); /* Soft shadow */
            max-width: 900px; /* Max width for readability */
            width: 95%; /* Responsive width */
            padding: 2.5rem; /* Ample padding */
            animation: fadeIn 0.5s ease-out; /* Fade-in animation */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .section-hidden {
            display: none !important; /* Use !important to ensure override */
        }
        /* Custom radio button styling */
        input[type="radio"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            border: 2px solid #cbd5e1; /* border-gray-300 */
            background-color: #ffffff;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        input[type="radio"]:checked {
            background-color: #4f46e5; /* indigo-600 */
            border-color: #4f46e5;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.2); /* ring-indigo-200 effect */
        }
        input[type="radio"]:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.5); /* Focus ring */
        }
        .question-option label {
            cursor: pointer;
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .modal {
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            display: flex; /* Always display flex when not hidden by section-hidden */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 2rem;
            border-radius: 0.75rem; /* Rounded corners */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        .modal-button {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .modal-button:hover {
            background-color: #4338ca; /* indigo-700 */
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Introduction Section -->
        <div id="intro-section" class="text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-6">ì‹œê°„ê´€ë¦¬ íš¨ê³¼ì„± ì§„ë‹¨</h1>
            <p class="text-lg text-gray-600 mb-4 leading-relaxed">
                ì´ ì§„ë‹¨ì€ ë‹¹ì‹ ì˜ í˜„ì¬ ì‹œê°„ ê´€ë¦¬ ìŠµê´€ê³¼ íš¨ìœ¨ì„±ì„ í‰ê°€í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.
                ë³¸ ì§„ë‹¨ì€ <strong>AMA (American Management Association)</strong> ì˜ ì‹œê°„ ê´€ë¦¬ ì›ì¹™ê³¼ ê³µì‹ ë ¥ ìˆëŠ” ì´ë¡ ì„ ë°”íƒ•ìœ¼ë¡œ êµ¬ì„±ëœ <strong>ëª¨ì˜ ì§„ë‹¨</strong>ì…ë‹ˆë‹¤.
                AMAëŠ” 100ë…„ì´ ë„˜ëŠ” ì—­ì‚¬ë¥¼ ê°€ì§„ ì„¸ê³„ì ì¸ ê²½ì˜ êµìœ¡ ê¸°ê´€ìœ¼ë¡œ, ë¹„ì¦ˆë‹ˆìŠ¤ ë° ê°œì¸ ì—­ëŸ‰ ê°œë°œ ë¶„ì•¼ì—ì„œ ë†’ì€ ì „ë¬¸ì„±ê³¼ ì‹ ë¢°ë„ë¥¼ ì¸ì •ë°›ê³  ìˆìŠµë‹ˆë‹¤.
            </p>
            <p class="text-lg text-gray-600 mb-8 leading-relaxed">
                ê° ë¬¸í•­ì— ëŒ€í•´ ë‹¹ì‹ ì˜ í–‰ë™ì´ë‚˜ ìƒê°ì— ê°€ì¥ ì˜ ë§ëŠ” ì ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. ë‹¹ì‹ ì˜ ì‹œê°„ ê´€ë¦¬ ìŠµê´€ì„ ê°ê´€ì ìœ¼ë¡œ ì´í•´í•˜ëŠ” ë° ìœ ìš©í•œ í†µì°°ì„ ì œê³µí•  ê²ƒì…ë‹ˆë‹¤.
            </p>
            <p class="text-md text-gray-500 mb-10">
                (1ì : ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤ / 2ì : ê±°ì˜ ê·¸ë ‡ì§€ ì•Šë‹¤ / 3ì : ë³´í†µì´ë‹¤ / 4ì : ëŒ€ì²´ë¡œ ê·¸ë ‡ë‹¤ / 5ì : í•­ìƒ ê·¸ë ‡ë‹¤)
            </p>
            <button id="start-assessment-btn"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition-colors duration-300 transform hover:scale-105">
                ì§„ë‹¨ ì‹œì‘í•˜ê¸°
            </button>
        </div>

        <!-- Question Section (Initially hidden) -->
        <div id="question-section" class="section-hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">ì§„ë‹¨ ë¬¸í•­</h2>
            <form id="assessment-form">
                <!-- Questions will be dynamically loaded here by JavaScript -->
            </form>
            <div class="mt-10 text-center">
                <button id="submit-assessment-btn"
                        class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition-colors duration-300 transform hover:scale-105">
                    ê²°ê³¼ ë³´ê¸°
                </button>
            </div>
        </div>

        <!-- Result Section (Initially hidden) -->
        <div id="result-section" class="section-hidden text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">ì§„ë‹¨ ê²°ê³¼</h2>
            <div id="total-score" class="text-2xl font-bold text-indigo-700 mb-4"></div>
            <div id="category-scores" class="text-left bg-gray-50 p-6 rounded-xl mb-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">ì˜ì—­ë³„ ì ìˆ˜:</h3>
                <!-- Category scores will be displayed here -->
            </div>
            <div id="feedback" class="text-left bg-blue-50 p-6 rounded-xl border border-blue-200">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">ì¢…í•© í”¼ë“œë°±:</h3>
                <!-- Feedback will be displayed here -->
            </div>
            <div class="mt-8 flex justify-center gap-4">
                <button id="download-result-btn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition-colors duration-300 transform hover:scale-105">
                    ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
                </button>
                <button id="restart-assessment-btn"
                        class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-8 rounded-full shadow-lg transition-colors duration-300 transform hover:scale-105">
                    ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Messages -->
    <div id="custom-modal" class="modal section-hidden">
        <div class="modal-content">
            <p id="modal-message" class="text-lg text-gray-700 mb-6"></p>
            <button id="modal-ok-btn" class="modal-button">í™•ì¸</button>
        </div>
    </div>

    <script>
        // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const introSection = document.getElementById('intro-section');
        const questionSection = document.getElementById('question-section');
        const resultSection = document.getElementById('result-section');
        const startButton = document.getElementById('start-assessment-btn');
        const submitButton = document.getElementById('submit-assessment-btn');
        const restartButton = document.getElementById('restart-assessment-btn');
        const downloadButton = document.getElementById('download-result-btn'); // New download button
        const assessmentForm = document.getElementById('assessment-form');
        const totalScoreDisplay = document.getElementById('total-score');
        const categoryScoresDisplay = document.getElementById('category-scores');
        const feedbackDisplay = document.getElementById('feedback');

        // Modal elements
        const customModal = document.getElementById('custom-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalOkButton = document.getElementById('modal-ok-btn');

        // ì§„ë‹¨ ë¬¸í•­ ë°ì´í„°
        // ê° ë¬¸í•­ì€ ê³ ìœ í•œ ID ì ‘ë‘ì‚¬, ì§ˆë¬¸ í…ìŠ¤íŠ¸, ì†í•˜ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
        const questions = [
            { category: "ëª©í‘œ ì„¤ì • ë° ìš°ì„ ìˆœìœ„", idPrefix: "q1", text: "ë§¤ì¼/ë§¤ì£¼ ì¤‘ìš”í•œ ëª©í‘œë¥¼ ëª…í™•íˆ ì •ì˜í•©ë‹ˆë‹¤." },
            { category: "ëª©í‘œ ì„¤ì • ë° ìš°ì„ ìˆœìœ„", idPrefix: "q2", text: "ì—…ë¬´ ì‹œì‘ ì „ ìš°ì„ ìˆœìœ„ë¥¼ ì •í•˜ê³  ì¤‘ìš”í•œ ì¼ë¶€í„° ì²˜ë¦¬í•©ë‹ˆë‹¤." },
            { category: "ëª©í‘œ ì„¤ì • ë° ìš°ì„ ìˆœìœ„", idPrefix: "q3", text: "ê¸‰í•œ ì¼ê³¼ ì¤‘ìš”í•œ ì¼ì„ êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬í•©ë‹ˆë‹¤." },
            { category: "ê³„íš ë° ìŠ¤ì¼€ì¤„ë§", idPrefix: "q4", text: "ë§¤ì¼/ë§¤ì£¼ í•  ì¼ ëª©ë¡(To-do list)ì„ ì‘ì„±í•˜ê³  í™œìš©í•©ë‹ˆë‹¤." },
            { category: "ê³„íš ë° ìŠ¤ì¼€ì¤„ë§", idPrefix: "q5", text: "ì¤‘ìš”í•œ ì•½ì†ì´ë‚˜ ë§ˆê° ê¸°í•œì„ ìŠ¤ì¼€ì¤„ëŸ¬ì— ê¸°ë¡í•˜ê³  í™•ì¸í•©ë‹ˆë‹¤." },
            { category: "ê³„íš ë° ìŠ¤ì¼€ì¤„ë§", idPrefix: "q6", text: "ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ìƒí™©ì— ëŒ€ë¹„í•´ ê³„íšì— ìœ ì—°ì„±ì„ ë‘¡ë‹ˆë‹¤." },
            { category: "ë°©í•´ ìš”ì†Œ ê´€ë¦¬", idPrefix: "q7", text: "ë¶ˆí•„ìš”í•œ ì•Œë¦¼, ì „í™” ë“±ìœ¼ë¡œ ì¸í•œ ë°©í•´ë¥¼ ìµœì†Œí™”í•©ë‹ˆë‹¤." },
            { category: "ë°©í•´ ìš”ì†Œ ê´€ë¦¬", idPrefix: "q8", text: "ì—…ë¬´ ì¤‘ ì†Œì…œ ë¯¸ë””ì–´ë‚˜ ë¶ˆí•„ìš”í•œ ì¸í„°ë„· ì„œí•‘ì„ ìì œí•©ë‹ˆë‹¤." },
            { category: "ë°©í•´ ìš”ì†Œ ê´€ë¦¬", idPrefix: "q9", text: "ì§‘ì¤‘ì„ ë°©í•´í•˜ëŠ” ìš”ì†Œë¥¼ ì œê±°í•˜ê¸° ìœ„í•´ ë…¸ë ¥í•©ë‹ˆë‹¤." },
            { category: "ë¯¸ë£¨ëŠ” ìŠµê´€ ê´€ë¦¬", idPrefix: "q10", text: "ì¤‘ìš”í•˜ì§€ë§Œ í•˜ê¸° ì‹«ì€ ì¼ì„ ë¯¸ë£¨ì§€ ì•Šê³  ë°”ë¡œ ì‹œì‘í•˜ëŠ” í¸ì…ë‹ˆë‹¤." },
            { category: "ë¯¸ë£¨ëŠ” ìŠµê´€ ê´€ë¦¬", idPrefix: "q11", text: "ì–´ë ¤ìš´ ì—…ë¬´ë¥¼ ì‘ì€ ë‹¨ìœ„ë¡œ ìª¼ê°œì–´ ì ‘ê·¼í•©ë‹ˆë‹¤." },
            { category: "ìœ„ì„ ë° ê±°ì ˆ", idPrefix: "q12", text: "ë‚´ê°€ í•  í•„ìš” ì—†ëŠ” ì¼ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì ì ˆíˆ ìœ„ì„í•©ë‹ˆë‹¤." },
            { category: "ìœ„ì„ ë° ê±°ì ˆ", idPrefix: "q13", "text": "ë¶ˆí•„ìš”í•˜ê±°ë‚˜ ê³¼ë„í•œ ìš”ì²­ì— ëŒ€í•´ ë‹¨í˜¸í•˜ê²Œ ê±°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
        ];

        // ëª¨ë‹¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function showMessageModal(message) {
            modalMessage.textContent = message;
            customModal.classList.remove('section-hidden');
            // ëª¨ë‹¬ì´ ë‚˜íƒ€ë‚  ë•Œ í¬ì»¤ìŠ¤ ê´€ë¦¬ (ì ‘ê·¼ì„±)
            modalOkButton.focus();
        }

        // ëª¨ë‹¬ì„ ìˆ¨ê¸°ëŠ” í•¨ìˆ˜
        function hideMessageModal() {
            customModal.classList.add('section-hidden');
        }

        // ì§„ë‹¨ ë¬¸í•­ì„ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
        function renderQuestions() {
            assessmentForm.innerHTML = ''; // ê¸°ì¡´ ë¬¸í•­ ì´ˆê¸°í™”
            let currentCategoryDiv = null;
            let currentCategory = '';

            questions.forEach((q, index) => {
                if (q.category !== currentCategory) {
                    // ìƒˆ ì¹´í…Œê³ ë¦¬ ì‹œì‘
                    currentCategory = q.category;
                    currentCategoryDiv = document.createElement('div');
                    currentCategoryDiv.className = 'mb-8 p-6 bg-blue-50 rounded-xl shadow-sm border border-blue-200';
                    const categoryTitle = document.createElement('h3');
                    categoryTitle.className = 'text-xl font-semibold text-indigo-800 mb-4 border-b pb-2 border-blue-300';
                    categoryTitle.textContent = currentCategory;
                    currentCategoryDiv.appendChild(categoryTitle);
                    assessmentForm.appendChild(currentCategoryDiv);
                }

                const questionDiv = document.createElement('div');
                questionDiv.className = 'mb-6 p-4 bg-white rounded-lg shadow-sm';

                const questionText = document.createElement('p');
                questionText.className = 'text-lg font-medium text-gray-800 mb-3';
                questionText.textContent = `${index + 1}. ${q.text}`;
                questionDiv.appendChild(questionText);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'flex flex-wrap gap-4 justify-center sm:justify-start';

                // 1ì ì—ì„œ 5ì ê¹Œì§€ì˜ ë¼ë””ì˜¤ ë²„íŠ¼ ìƒì„±
                for (let i = 1; i <= 5; i++) {
                    const optionContainer = document.createElement('div');
                    optionContainer.className = 'question-option flex items-center';

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.id = `${q.idPrefix}-${i}`;
                    input.name = q.idPrefix; // ê°™ì€ nameìœ¼ë¡œ ê·¸ë£¹í™”
                    input.value = i;
                    input.className = 'form-radio h-5 w-5 text-indigo-600 transition-colors duration-200';

                    const label = document.createElement('label');
                    label.htmlFor = `${q.idPrefix}-${i}`;
                    label.className = 'ml-2 text-gray-700 text-base';
                    label.textContent = `${i}ì `;

                    optionContainer.appendChild(input);
                    optionContainer.appendChild(label);
                    optionsDiv.appendChild(optionContainer);
                }
                questionDiv.appendChild(optionsDiv);
                currentCategoryDiv.appendChild(questionDiv);
            });
        }

        // ì§„ë‹¨ ê²°ê³¼ë¥¼ ê³„ì‚°í•˜ê³  í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function calculateAndDisplayResults() {
            let totalScore = 0;
            const categoryScores = {};
            let allAnswered = true;

            // ê° ì¹´í…Œê³ ë¦¬ ì´ˆê¸°í™”
            questions.forEach(q => {
                if (!(q.category in categoryScores)) {
                    categoryScores[q.category] = 0;
                }
            });

            // ëª¨ë“  ì§ˆë¬¸ì— ëŒ€í•œ ì‘ë‹µ í™•ì¸ ë° ì ìˆ˜ ê³„ì‚°
            questions.forEach(q => {
                const selectedOption = document.querySelector(`input[name="${q.idPrefix}"]:checked`);
                if (selectedOption) {
                    const score = parseInt(selectedOption.value);
                    totalScore += score;
                    categoryScores[q.category] += score;
                } else {
                    allAnswered = false; // ì‘ë‹µí•˜ì§€ ì•Šì€ ì§ˆë¬¸ì´ ìˆìŒ
                }
            });

            if (!allAnswered) {
                // ëª¨ë“  ì§ˆë¬¸ì— ì‘ë‹µí•˜ì§€ ì•Šì•˜ë‹¤ë©´ ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
                showMessageModal("ëª¨ë“  ë¬¸í•­ì— ë‹µë³€í•´ì£¼ì„¸ìš”!");
                return;
            }

            // ì„¹ì…˜ ì „í™˜: ì§ˆë¬¸ ì„¹ì…˜ ìˆ¨ê¸°ê³  ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            questionSection.classList.add('section-hidden');
            resultSection.classList.remove('section-hidden');

            // ì´ì  í‘œì‹œ
            totalScoreDisplay.textContent = `ì´ì : ${totalScore}ì `;

            // ì¹´í…Œê³ ë¦¬ë³„ ì ìˆ˜ í‘œì‹œ
            categoryScoresDisplay.innerHTML = '<h3 class="text-xl font-semibold text-gray-700 mb-4">ì˜ì—­ë³„ ì ìˆ˜:</h3>';
            for (const category in categoryScores) {
                const p = document.createElement('p');
                p.className = 'text-md text-gray-700 mb-2';
                p.textContent = `- ${category}: ${categoryScores[category]}ì `;
                categoryScoresDisplay.appendChild(p);
            }

            // í”¼ë“œë°± ì œê³µ (ì´ì  ë° ì¹´í…Œê³ ë¦¬ë³„)
            feedbackDisplay.innerHTML = '<h3 class="text-xl font-semibold text-gray-700 mb-4">ì¢…í•© í”¼ë“œë°±:</h3>'; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

            const maxPossibleScore = questions.length * 5;
            const scorePercentage = (totalScore / maxPossibleScore) * 100;
            let overallFeedbackText = '';

            if (scorePercentage >= 85) {
                overallFeedbackText = "â­ í›Œë¥­í•©ë‹ˆë‹¤! ë‹¹ì‹ ì€ ì‹œê°„ì„ ë§¤ìš° íš¨ê³¼ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ìˆìœ¼ë©°, ë†’ì€ ìˆ˜ì¤€ì˜ íš¨ìœ¨ì„±ê³¼ ìƒì‚°ì„±ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. í˜„ì¬ì˜ ê°•ì ì„ ìœ ì§€í•˜ë©° ì§€ì†ì ìœ¼ë¡œ ë°œì „í•˜ì„¸ìš”.";
            } else if (scorePercentage >= 70) {
                overallFeedbackText = "ğŸ‘ ë‹¹ì‹ ì€ ì‹œê°„ ê´€ë¦¬ë¥¼ ì˜ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ì˜ì—­ì—ì„œ íš¨ìœ¨ì ì¸ ìŠµê´€ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, ëª‡ëª‡ ê°œì„ ì ì„ í†µí•´ ë” ë†’ì€ ì„±ê³¼ë¥¼ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            } else if (scorePercentage >= 50) {
                overallFeedbackText = "ğŸ¤” ì‹œê°„ ê´€ë¦¬ ëŠ¥ë ¥ì„ í–¥ìƒì‹œí‚¬ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ íŠ¹ì • ì˜ì—­ì—ì„œ ì–´ë ¤ì›€ì„ ê²ªê³  ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ, ì§„ë‹¨ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ êµ¬ì²´ì ì¸ ê°œì„  ê³„íšì„ ì„¸ìš°ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.";
            } else {
                overallFeedbackText = "â— ì‹œê°„ ê´€ë¦¬ ìŠµê´€ì— ëŒ€í•œ ì‹¬ê°í•œ ì¬í‰ê°€ê°€ í•„ìš”í•©ë‹ˆë‹¤. ê¸°ë³¸ì ì¸ ì‹œê°„ ê´€ë¦¬ ì›ì¹™ë¶€í„° ë‹¤ì‹œ ì ê²€í•˜ê³ , ì ê·¹ì ì¸ ë…¸ë ¥ì„ ê¸°ìš¸ì—¬ ì‹œê°„ ê´€ë¦¬ íš¨ìœ¨ì„ ë†’ì—¬ì•¼ í•©ë‹ˆë‹¤.";
            }
            const overallP = document.createElement('p');
            overallP.className = 'text-lg text-gray-700 leading-relaxed mb-6';
            overallP.textContent = overallFeedbackText;
            feedbackDisplay.appendChild(overallP);

            // ê° ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ í”¼ë“œë°±
            feedbackDisplay.innerHTML += '<h3 class="text-xl font-semibold text-gray-700 mb-4 border-t pt-4 mt-4 border-blue-200">ì˜ì—­ë³„ ìƒì„¸ í”¼ë“œë°±:</h3>';

            for (const category in categoryScores) {
                const numQuestionsInCategory = questions.filter(q => q.category === category).length;
                const maxCategoryScore = numQuestionsInCategory * 5;
                const categoryScorePercentage = (categoryScores[category] / maxCategoryScore) * 100;

                const categoryFeedbackP = document.createElement('p');
                categoryFeedbackP.className = 'text-md text-gray-700 leading-relaxed mb-4 p-3 bg-white rounded-lg shadow-sm';

                let feedback = `<strong>${category}:</strong> `;
                if (categoryScorePercentage >= 80) {
                    feedback += "ë›°ì–´ë‚¨! ì´ ì˜ì—­ì—ì„œ ë†’ì€ íš¨ìœ¨ì„±ì„ ë³´ì…ë‹ˆë‹¤. ê°•ì ì„ ìœ ì§€í•˜ê³  ë”ìš± ë°œì „ì‹œí‚¤ì„¸ìš”.";
                } else if (categoryScorePercentage >= 60) {
                    feedback += "ì–‘í˜¸í•¨. ì´ ì˜ì—­ì—ì„œ ì¢‹ì€ ì‹œê°„ ê´€ë¦¬ ìŠµê´€ì„ ê°€ì§€ê³  ìˆì§€ë§Œ, ë” ë†’ì€ íš¨ìœ¨ì„ ìœ„í•´ ì•½ê°„ì˜ ê°œì„ ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                } else {
                    feedback += "ê°œì„  í•„ìš”. ì´ ì˜ì—­ì—ì„œ ì‹œê°„ ê´€ë¦¬ ëŠ¥ë ¥ì„ í–¥ìƒì‹œí‚¬ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì¡°ì–¸ì„ ì°¸ê³ í•˜ì„¸ìš”:<br>";
                    if (category === "ëª©í‘œ ì„¤ì • ë° ìš°ì„ ìˆœìœ„") {
                        feedback += "- ëª©í‘œë¥¼ SMART(êµ¬ì²´ì , ì¸¡ì • ê°€ëŠ¥, ë‹¬ì„± ê°€ëŠ¥, ê´€ë ¨ì„± ìˆëŠ”, ê¸°í•œ ìˆëŠ”)í•˜ê²Œ ì„¤ì •í•˜ê³ , ì•„ì´ì  í•˜ì›Œ ë§¤íŠ¸ë¦­ìŠ¤(ê¸´ê¸‰ì„±/ì¤‘ìš”ì„±)ë¥¼ í™œìš©í•˜ì—¬ ìš°ì„ ìˆœìœ„ë¥¼ ëª…í™•íˆ í•˜ì„¸ìš”.";
                    } else if (category === "ê³„íš ë° ìŠ¤ì¼€ì¤„ë§") {
                        feedback += "- ë§¤ì¼/ë§¤ì£¼ í•  ì¼ ëª©ë¡ì„ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ê³ , ìº˜ë¦°ë”ë‚˜ ì•±ì„ í™œìš©í•˜ì—¬ ì£¼ìš” ì¼ì •ì„ ë¸”ë¡í‚¹í•˜ì„¸ìš”. ì˜ˆìƒì¹˜ ëª»í•œ ìƒí™©ì— ëŒ€ë¹„í•œ ìœ ì—°í•œ ê³„íšë„ ì¤‘ìš”í•©ë‹ˆë‹¤.";
                    } else if (category === "ë°©í•´ ìš”ì†Œ ê´€ë¦¬") {
                        feedback += "- ì—…ë¬´ ì¤‘ ìŠ¤ë§ˆíŠ¸í° ì•Œë¦¼ ë„ê¸°, ë¶ˆí•„ìš”í•œ ì›¹ì‚¬ì´íŠ¸ ì°¨ë‹¨, ì •í•´ì§„ ì‹œê°„ì—ë§Œ ì´ë©”ì¼ í™•ì¸í•˜ê¸° ë“± ì§‘ì¤‘ì„ ë°©í•´í•˜ëŠ” ìš”ì†Œë¥¼ ì˜ì‹ì ìœ¼ë¡œ ì œê±°í•˜ì„¸ìš”.";
                    } else if (category === "ë¯¸ë£¨ëŠ” ìŠµê´€ ê´€ë¦¬") {
                        feedback += "- í° ì—…ë¬´ë¥¼ ì‘ì€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ì‹œì‘í•˜ê³ , '5ë¶„ ê·œì¹™'(ì¼ë‹¨ 5ë¶„ë§Œ í•´ë³´ê¸°)ì„ ì ìš©í•´ë³´ì„¸ìš”. ì™„ë£Œ ì‹œ ìì‹ ì—ê²Œ ì‘ì€ ë³´ìƒì„ ì£¼ëŠ” ê²ƒë„ ë„ì›€ì´ ë©ë‹ˆë‹¤.";
                    } else if (category === "ìœ„ì„ ë° ê±°ì ˆ") {
                        feedback += "- í˜¼ì ëª¨ë“  ê²ƒì„ í•˜ë ¤ í•˜ì§€ ë§ˆì„¸ìš”. ì ì ˆí•œ ì—…ë¬´ëŠ” íƒ€ì¸ì—ê²Œ ìœ„ì„í•˜ê³ , ìì‹ ì˜ í•œê³„ë¥¼ ë„˜ì–´ì„œëŠ” ìš”ì²­ì´ë‚˜ ë¶ˆí•„ìš”í•œ ìš”ì²­ì—ëŠ” ì •ì¤‘í•˜ê²Œ 'ì•„ë‹ˆì˜¤'ë¼ê³  ë§í•˜ëŠ” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.";
                    }
                }
                categoryFeedbackP.innerHTML = feedback; // innerHTMLì„ ì‚¬ìš©í•˜ì—¬ HTML íƒœê·¸ í•´ì„
                feedbackDisplay.appendChild(categoryFeedbackP);
            }

            // ê²°ê³¼ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        /**
         * ê²°ê³¼ ì„¹ì…˜ì„ ì´ë¯¸ì§€ë¡œ ìº¡ì²˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
         */
        function downloadResultImage() {
            // ìº¡ì²˜í•  ìš”ì†Œ ì§€ì • (ì—¬ê¸°ì„œëŠ” ì „ì²´ ê²°ê³¼ ì„¹ì…˜)
            const elementToCapture = document.getElementById('result-section');

            // html2canvas ì˜µì…˜: ë°°ê²½ìƒ‰ì„ í°ìƒ‰ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ íˆ¬ëª… ë°°ê²½ ë¬¸ì œë¥¼ ë°©ì§€
            // scaleì„ ë†’ì—¬ ê³ í•´ìƒë„ ì´ë¯¸ì§€ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ (í•„ìš”ì— ë”°ë¼ ì¡°ì •)
            html2canvas(elementToCapture, {
                backgroundColor: '#ffffff',
                scale: 2 // Increase scale for better quality image
            }).then(canvas => {
                // ìº¡ì²˜ëœ ìº”ë²„ìŠ¤ì—ì„œ ì´ë¯¸ì§€ ë°ì´í„° URL ê°€ì ¸ì˜¤ê¸°
                const imageDataURL = canvas.toDataURL('image/png');

                // ë‹¤ìš´ë¡œë“œë¥¼ ìœ„í•œ ì„ì‹œ ë§í¬ ìƒì„±
                const a = document.createElement('a');
                a.href = imageDataURL;
                a.download = 'ì‹œê°„ê´€ë¦¬_íš¨ê³¼ì„±_ì§„ë‹¨_ê²°ê³¼.png'; // ë‹¤ìš´ë¡œë“œë  íŒŒì¼ ì´ë¦„ ì„¤ì •
                document.body.appendChild(a); // ë§í¬ë¥¼ ë¬¸ì„œì— ì¶”ê°€ (í•„ìˆ˜)
                a.click(); // ë§í¬ í´ë¦­í•˜ì—¬ ë‹¤ìš´ë¡œë“œ íŠ¸ë¦¬ê±°
                document.body.removeChild(a); // ì‚¬ìš© í›„ ë§í¬ ì œê±°
            }).catch(error => {
                console.error("ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                showMessageModal("ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            });
        }


        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        startButton.addEventListener('click', () => {
            introSection.classList.add('section-hidden'); // ì¸íŠ¸ë¡œ ìˆ¨ê¸°ê¸°
            questionSection.classList.remove('section-hidden'); // ì§ˆë¬¸ ì„¹ì…˜ ë³´ì´ê¸°
            renderQuestions(); // ì§ˆë¬¸ ë Œë”ë§
            // ì§ˆë¬¸ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
            questionSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        submitButton.addEventListener('click', () => {
            calculateAndDisplayResults(); // ê²°ê³¼ ê³„ì‚° ë° í‘œì‹œ
        });

        restartButton.addEventListener('click', () => {
            resultSection.classList.add('section-hidden'); // ê²°ê³¼ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            introSection.classList.remove('section-hidden'); // ì¸íŠ¸ë¡œ ì„¹ì…˜ ë³´ì´ê¸°
            assessmentForm.reset(); // í¼ ì´ˆê¸°í™” (ì„ íƒëœ ë¼ë””ì˜¤ ë²„íŠ¼ í•´ì œ)
            // ì¸íŠ¸ë¡œ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
            introSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        downloadButton.addEventListener('click', downloadResultImage); // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€

        modalOkButton.addEventListener('click', hideMessageModal);

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = () => {
            // ëª¨ë“  ì„¹ì…˜ì„ ìˆ¨ê¸°ê³  ì¸íŠ¸ë¡œë§Œ í‘œì‹œ (ì´ˆê¸° ìƒíƒœ)
            questionSection.classList.add('section-hidden');
            resultSection.classList.add('section-hidden');
            customModal.classList.add('section-hidden'); /* ëª¨ë‹¬ë„ ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
            introSection.classList.remove('section-hidden');
        };
    </script>
</body>
</html>
